from pptx import Presentation
from pptx.util import Inches, Pt
from pptx.dml.color import RGBColor

# Crée une présentation
prs = Presentation()

# Données des slides (titre et texte)
slides_content = [
    ("Sujet 5 : Frontend Testing", "Stratégies pour des apps robustes et maintenables\nApplication : Gestion de Bibliothèque (CRUD)\nSystème complet de gestion de livres, auteurs et catégories avec authentification sécurisée."),
    ("But du TP & Stratégie", "Pourquoi tester ?\nGarantir que les nouvelles fonctionnalités ne cassent pas l'existant (non-régression) et automatiser la validation métier.\n\nPyramide des tests\nTests unitaires pour la logique (Jest) et tests E2E pour le parcours utilisateur.\n\nMaintenabilité\nUne base de code testée permet des refactorisations sereines et un déploiement continu fiable."),
    ("Pipeline CI/CD (GitHub Actions)", "Automatisation Totale\n- Infrastructure : PostgreSQL 15\n- Prisma : db push\n- Backend : 38 tests Jest\n- Frontend : Playwright E2E\n\nWorkflow GitHub :\non: push\njobs: everything\nsteps: prisma db push, npm run test, npx playwright test"),
    ("Résultats Backend (Jest)", "PASS  src/category/category.service.spec.ts\nPASS  src/app.controller.spec.ts\n... (tous les tests)\nTest Suites: 7 passed, 7 total\nTests: 38 passed, 38 total\nCoverage: Statements 99.21%, Branches 76.78%, Functions 97.5%, Lines 99.09%"),
    ("Résultats Frontend (Playwright)", "✓ 1 CRUD Auteur - Créer puis Supprimer\n✓ 2 Titre page correct\n✓ 3 CRUD Catégorie - Créer puis Supprimer\n✓ 4 CRUD Livre - Créer puis Supprimer\n✓ 5 Mauvais Mot de Passe\n✓ 6 Utilisateur Inconnu\n✓ 7 Connexion Réussie"),
    ("Preuves Visuelles", ""),  # les images seront ajoutées plus bas
    ("Défis & Solutions", "Conflit de Port (EADDRINUSE)\nSolution : Nettoyage forcé des ports 3000\nSynchronisation Dialogues\nSolution : waitForEvent('dialog')\nDoublons de Données\nSolution : Noms uniques avec Date.now()")
]

# Images pour la slide "Preuves Visuelles"
images = [
    ("login_success.png", "Authentification OK"),
    ("crud_1_categorie_creee.png", "Création Catégorie"),
    ("crud_5_livre_cree.png", "Livre & Relations"),
    ("login_bad_password.png", "Validation Dialog"),
    ("crud_2_categorie_supprimee.png", "Nettoyage Catégorie"),
    ("crud_4_auteur_supprime.png", "Nettoyage Auteur")
]

# Fonction pour ajouter une slide texte
def add_text_slide(title, content):
    slide_layout = prs.slide_layouts[5]  # slide vide
    slide = prs.slides.add_slide(slide_layout)
    # Titre
    title_box = slide.shapes.add_textbox(Inches(0.5), Inches(0.2), Inches(9), Inches(1))
    tf = title_box.text_frame
    p = tf.paragraphs[0]
    p.text = title
    p.font.size = Pt(36)
    p.font.bold = True
    p.font.color.rgb = RGBColor(0x00, 0x80, 0xFF)
    # Contenu
    content_box = slide.shapes.add_textbox(Inches(0.5), Inches(1.5), Inches(9), Inches(5))
    tf = content_box.text_frame
    for line in content.split("\n"):
        p = tf.add_paragraph()
        p.text = line
        p.font.size = Pt(18)
        p.font.color.rgb = RGBColor(255, 255, 255)

# Ajouter les slides texte
for i, (title, content) in enumerate(slides_content):
    if i != 5:  # sauf la slide des images
        add_text_slide(title, content)

# Slide 6 : Preuves Visuelles avec images
slide_layout = prs.slide_layouts[5]
slide = prs.slides.add_slide(slide_layout)
title_box = slide.shapes.add_textbox(Inches(0.5), Inches(0.2), Inches(9), Inches(1))
tf = title_box.text_frame
p = tf.paragraphs[0]
p.text = "Preuves Visuelles"
p.font.size = Pt(36)
p.font.bold = True
p.font.color.rgb = RGBColor(255, 105, 180)

# Ajouter les images
x, y = 0.5, 1.5
for img_path, caption in images:
    slide.shapes.add_picture(img_path, Inches(x), Inches(y), width=Inches(3))
    # Caption
    caption_box = slide.shapes.add_textbox(Inches(x), Inches(y + 1.7), Inches(3), Inches(0.5))
    tf = caption_box.text_frame
    tf.text = caption
    tf.paragraphs[0].font.size = Pt(14)
    tf.paragraphs[0].font.color.rgb = RGBColor(255, 255, 255)
    x += 3.2
    if x > 6:
        x = 0.5
        y += 2.2

# Enregistrer le fichier
prs.save("presentation_frontend_testing.pptx")
print("PowerPoint généré : presentation_frontend_testing.pptx")
